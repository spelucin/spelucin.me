---
import MobileMenu from './MobileMenu.astro';
import { Menu, X } from 'lucide-react';
---

<header class="w-full overflow-x-hidden fixed top-0 left-0 right-0 z-50 px-6 py-4 max-[480px]:px-3" id="main-header">
  <div class="max-w-6xl mx-auto bg-[rgba(15,23,42,0.7)] backdrop-blur-xl border border-glass rounded-lg px-6 py-3 flex items-center justify-between shadow-[0_8px_32px_rgba(0,0,0,0.3)] min-w-0 w-full">
    <a href="/" class="flex items-center gap-3">
      <img src="/img/logo.svg" alt="Alex Spelucin Logo" class="w-7 h-7" />
    </a>
    <button
      class="hidden max-lg:flex items-center justify-center w-10 h-10 bg-transparent border-none cursor-pointer p-0 z-10 focus:outline-2 focus:outline-ring-accent focus:outline-offset-2 mobile-menu-button"
      aria-label="Toggle menu"
      aria-expanded="false"
      id="mobile-menu-button"
    >
      <Menu size={28} className="text-text-0" client:load />
    </button>
    <nav
      class="flex items-center gap-6 max-lg:hidden"
      id="navbar-navigation-desktop"
    >
      <a href="#about" class="text-text-1 no-underline transition-colors duration-150 hover:text-text-0 nav-link">
        Sobre mí
      </a>
      <a href="#skills" class="text-text-1 no-underline transition-colors duration-150 hover:text-text-0 nav-link">
        Habilidades
      </a>
      <a href="#testimonials" class="text-text-1 no-underline transition-colors duration-150 hover:text-text-0 nav-link">
        Testimonios
      </a>
      <a href="#contact" class="text-text-1 no-underline transition-colors duration-150 hover:text-text-0 nav-link">
        Contacto
      </a>
      <a
        href="#contact"
        class="px-4 py-2 font-medium shadow-[0_0_#0000,0_0_#0000,0_1px_2px_0_rgba(0,0,0,0.05)] transition-all duration-150 bg-primary text-text-invert border-transparent rounded hover:opacity-95 focus:shadow-[0_0_0_0px_#fff,0_0_0_calc(2px+0px)_var(--ring-accent),0_4px_6px_-1px_rgba(0,0,0,0.4),0_2px_4px_-2px_rgba(0,0,0,0.4)] focus:outline-2 focus:outline-transparent focus:outline-offset-2"
      >
        Trabaja conmigo
      </a>
    </nav>
  </div>
  
  <!-- Mobile Menu Overlay -->
  <div
    class="hidden fixed top-0 left-0 w-full h-full bg-black/50 z-[48] opacity-0 transition-opacity duration-300 backdrop-blur-[2px] mobile-menu-overlay"
    id="mobile-menu-overlay"
  ></div>
  
  <!-- Mobile Navigation -->
  <nav
    class="lg:hidden fixed top-0 -right-full w-full max-w-80 h-screen bg-surface-1 border-l border-glass flex flex-col items-start justify-start pt-4 px-6 pb-8 gap-6 transition-[right] duration-300 z-[49] shadow-[-4px_0_24px_rgba(0,0,0,0.3)]"
    id="navbar-navigation"
    aria-expanded="false"
  >
    <!-- Close button -->
    <button
      class="self-end p-2 bg-transparent border-none cursor-pointer focus:outline-2 focus:outline-ring-accent focus:outline-offset-2 mb-2"
      aria-label="Cerrar menú"
      id="mobile-menu-close"
    >
      <X size={28} className="text-text-0" client:load />
    </button>
    
    <a href="#about" class="text-text-1 no-underline transition-colors duration-150 hover:text-text-0 w-full py-3 text-left nav-link">
      Sobre mí
    </a>
    <a href="#skills" class="text-text-1 no-underline transition-colors duration-150 hover:text-text-0 w-full py-3 text-left nav-link">
      Habilidades
    </a>
    <a href="#testimonials" class="text-text-1 no-underline transition-colors duration-150 hover:text-text-0 w-full py-3 text-left nav-link">
      Testimonios
    </a>
    <a href="#contact" class="text-text-1 no-underline transition-colors duration-150 hover:text-text-0 w-full py-3 text-left nav-link">
      Contacto
    </a>
    <a
      href="#contact"
      class="px-4 py-2 font-medium shadow-[0_0_#0000,0_0_#0000,0_1px_2px_0_rgba(0,0,0,0.05)] transition-all duration-150 bg-primary text-text-invert border-transparent rounded w-full py-3 text-center mt-2 block hover:opacity-95 focus:shadow-[0_0_0_0px_#fff,0_0_0_calc(2px+0px)_var(--ring-accent),0_4px_6px_-1px_rgba(0,0,0,0.4),0_2px_4px_-2px_rgba(0,0,0,0.4)] focus:outline-2 focus:outline-transparent focus:outline-offset-2"
    >
      Trabaja conmigo
    </a>
  </nav>
  
  <MobileMenu client:load />
</header>

<style>
  #main-header {
    transition: transform 0.3s ease-in-out;
  }

  #main-header.header-hidden {
    transform: translateY(-100%);
  }

  .mobile-menu-overlay.active {
    display: block;
    opacity: 1;
  }

  #navbar-navigation[aria-expanded='true'] {
    right: 0;
  }

  @media (max-width: 992px) {
    .mobile-menu-button {
      display: flex;
    }
  }
</style>

<script>
  let lastScrollTop = 0;
  let isScrolling = false;
  const header = document.getElementById('main-header');
  const scrollThreshold = 5; // Minimum scroll distance to trigger hide/show

  function handleScroll() {
    if (isScrolling) return;
    
    isScrolling = true;
    requestAnimationFrame(() => {
      const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
      
      // If at the top of the page, always show the header
      if (currentScroll <= 0) {
        header?.classList.remove('header-hidden');
      } 
      // Scrolling down - hide header
      else if (currentScroll > lastScrollTop && currentScroll > scrollThreshold) {
        header?.classList.add('header-hidden');
      } 
      // Scrolling up - show header
      else if (currentScroll < lastScrollTop) {
        header?.classList.remove('header-hidden');
      }
      
      lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
      isScrolling = false;
    });
  }

  // Add scroll event listener
  window.addEventListener('scroll', handleScroll, { passive: true });
</script>
